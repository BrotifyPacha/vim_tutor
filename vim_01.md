# Почему и как я использую Vim

## Вступление

Привет, меня зовут **BrotifyPacha**, Vim является моим текстовым редактором уже
почти год. Я использую его как **Php/Python** ide, и помимо чистого Vim,
использую эмулятор IdeaVim в **Android Studio**.

Да, скорее всего это зависимость, т.к. при использовании любого другого
текстового редактора более получаса у меня появляются следующие симптомы:

* Учащённое сердцебиение _(когда приходится перемещаться туда суда используя
  мышку)_
* Раздражительность _(если вдруг понадобилось сменить двойные кавычки на
  одинарные, или наоборот)_
* Дрож в руках (когда нужно найти другой файл)

Ладно, отбросив шутки в сторону, Vim не только мой редактор исходного кода,
я также использую его для просмотра лог файлов, json документов и
работы с .csv файлами, даже git я использую через Vim.

Сейчас сделаю для вас небольшой тест драйв:  
_Открываю учебный проектик прорабатываю создание фичи от получения задачи до коммита_

## Теория

Я не буду вам рассказывать в каком году был создан Vim. Как называется
программа на которой он основан. Или как зовут его автора. Это всё вы, при
желании, можете узнать из википедии.  
Я расскажу вам про подход который используется в Vim для работы с текстом и **4
основных режима** работы и для чего каждый из них нужен.

### Подход к работе с текстом

За каждым архитектурным решением Vim лежит один принцип - при
работе с текстовыми документами, чаще всего, пользователи не вводят новый текст,
а манипулируют уже существующим. Это правдиво не только для
программистов, но и для писателей.
Реализовано это тем, что Vim является режимным
текстовым редактором. Что это значит?
В без-режимном текстовом редакторе, (блокноте windows, notepad++, sublime)
каждая клавиша напрямую пишет символ в файл,
а в Vim, действие которое будет сделано по нажатию на клавишу, зависит
от того, в каком режиме находится пользователь.

Вот к примеру действие клавиши i в разных режимах

| Режим | Действие |
|-|-|
| Normal | Переход в режим ввода |
| Insert | Напечатать символ i |
| Command | Напечатать символ i в командную строку |
| Visual | Ничего |

### 4 основных режима

#### Normal mode (Обычный режим)

Уже из названия можно понять что это режим в
котором мы должны проводить большую часть нашего времени.  В этом режиме мы
оказываемся сразу после запуска. А попасть в этот режим из другого режима мы
можем нажав клавишу `Esc` (от англ. escape - *"убежать"* из другого режима обратно в обычный).

Используется он для перемещения по файлу (файлам) и для осуществления правок:
удаления текста любого объёма, корректировки отступов, корректировки регистра,
в общем, всё что связано с оперированием уже существующим текстом,
делается в этом режиме.

Посимвольное перемещение по файлу осуществляется с помощью клавиш `h` `j` `k` `l`,

* `h` - влево
* `j` - вниз
* `k` - вверх
* `l` - вправо

Поначалу, это очень не удобно, и каждый раз возникает вопрос: почему именно они?
Ответ прост - эргономика. Эти клавиши лежат на так называемой *"Домашней строке"*
\- это строка клавиш, на которой пользователь должен держать пальцы для наибольшей
эффективности набора текста.

Если не считать эти 4 клавиши, то Vim имеет самое логичное значение клавиш, по сравнению
с любой программой которую я когда либо использовал. К примеру:

Для перемещения в начало строки используется символ `0`. Семантически всё понятно,
начало строки - нулевой символ.

Для перемещения в конец строки используется символ `$`. Почему именно доллар? Те,
кто знаком с синтаксисом регулярных выражений уже всё поняли. Знак доллара в них
используется для обозначения конца строки.

Допустим у вас есть строка с отступами, и вам необходимо *"прыгнуть"* в
начало строки, `0` перенесёт вас на самый первый символ (пробел или таб),
но что если вам нужно попасть на первый "не пустой" символ строки?
Для этого используйте `^`.
Этот символ в регулярных выражениях означает начало строки.

Перемещаться внутри строки используя только `h` и `l` довольно медленно, попробуйте
`w` , `e` и `b` . Эти клавиши перемещают курсор по словам:

* следующее слово - `w` (от англ. word - слово)
* конец слова - `e` (от англ. end - конец)
* предыдущее слово - `b` (от англ. backwards - назад)

Эти же клавиши работают в верхнем регистре но немного иначе, если клавиши `w` ,
`e` , `b` перемещают нас по *"словам"* разделённым пробелами и символами
пунктуации, то их заглавные вариации `W` , `E` , `B` перемещают нас
исключительно по *"Словам"* разделённым пробелами.

Перед всеми клавишами перемещения можно добавить число, чтобы воспроизвести движение
множество раз:  
`4l` = `llll` , `3w` = `www` , `2w3e` = `wweee` , `100b` = `bbbbbb...bbbbbb` (100 раз).

Пока на этом остановимся, попрактикуйтесь в перемещении по строке и между строк.
К перемещению мы ещё вернёмся после того как поговорим о всех режимах.

Но если вам прямо не терпится, то вот ещё клавиши пользуясь которыми можно *"побегать"*
по файлу:  
`gg` , `G` , `{` , `}` , `f` , `F` , `t` , `T` .

Попробуйте понять куда вас перемещают клавиши `f` и `t`, и чем отличаются их
заглавные варианты. Если случайно нажмёте куда то не туда - не волнуйтесь.
Нажмите несколько раз `Esc`, и вы вернётесь домой - в Normal mode.

#### Insert mode (Режим ввода)

Режим в который мы "входим" когда нам нужно что то написать, переписать или
дописать.  Для переключения в этот режим используется клавиша `i` (i от
англ. insert - ввод). Заметьте, именно в нижнем регистре, потому что
`I` не просто переключает нас в режим ввода, но и ставит курсор в начало
строки.

Клавиши `i` и `I` не являются единственными клавишами которые
переключают нас в режим ввода, чтобы попасть в режим ввода также можно
использовать клавиши `a` , `A` , `c` , `C` , `s` , `S`.
На первый взгляд выглядит нелепо: столько клавиш потрачено в пустую, лишь для
того, чтобы переключать нас в режим ввода, но это не совсем так. Да, после нажатия
этих клавиш мы окажемся в режиме ввода, но каждая из них доставит нас туда слегка
иным путём:

* Клавиша `a`, в отличии от `i` поставит курсор, после символа, на котором
он находился в обычном режиме (от англ. after - после).
* Клавиша `A`, по аналогии с `I` поставит курсор, в конце строки.
* Клавиша `s`, перед переносом нас в режим ввода, удалит символ под курсором.
* Клавиша `S`, перед переносом нас в режим ввода, удалит весь текст на текущей строке.

Хочу обратить ваше внимание на семантическую однородность в Vim:  
Хочешь выполнить действие?  
\- Нажми клавишу `n`  
Хочешь выполнить это действие но на большем масштабе?  
\- Нажми клавишу `N` (та же клавиша но в верхнем регистре)

**Важный ньюанс:** будучи в режиме ввода мы можем удалять любой текст, но для
этой цели следует использовать
обычный режим (Normal), т.к. в нём мы можем делать это гораздо эргономичнее.

#### Command mode (Командный режим / Режим инструкций)

Используется для выполнения команд, а также для настройки Vim посредством этих
команд. Да, звучит не особо понятно, поэтому вот пример: чтобы сохранить файл
нужно использовать команду `write`, но перед этим нужно попасть в командный
режим, нажав клавишу `:`, после успешного ввода команды нажимаем `Enter`.
Таким образом мы нажали клавиши `:write<cr>`.

Я специально написал `<cr>` а не просто `Enter` так как Vim воспринимает наш
`Enter` именно как последовательность `<cr>` (от англ. Carriage Return).
Также обратите внимание на то что я использовал `<` `>` скобки, это всё нотация
которую использует Vim.

Но ни один человек в здравом состоянии ума не будет постоянно писать`:write<cr>`
для того чтобы сохранить файл, поэтому у всех команд в Vim есть короткая
вариация. У команды `write` это `w`. То есть сохранение файла для нас
сократилось с нажатия 7 клавиш до 3 - `:w<cr>`, чуть позже мы сможем, при
желании, снизить это кол-во клавиш до одной, но это спойлеры, так что
продолжаем.

#### Visual mode (Визуальный режим)

Режим в котором мы визуально выделяем текст для последующей манипуляции. Для
того чтобы в него попасть используются клавиши `v` , `V` , `<C-v>` .
Три разных клавиши для трёх разных типов визуального режима:

* Используюя клавишу `v` мы попадаем в символьный визуальный режим
* Используюя клавишу `V` мы попадаем в строчный визуальный режим
* А используюя `<C-v>` мы попадаем в блочный визуальный режим

Названия говорят за себя: в символьном выбор осуществляется по символам,
в строчном - по строкам, в блочном - блоком.

Вы сейчас скорее всего задаётесь вопросом, что за `<C-v>`? Как это набрать?
Это уже упомянутая мной клавишная нотация Vim. Читается она следующим образом,
если внутри треугольных скобок символы разделены знаком `-` (как в нашем
случае), то мы должны воспринимать это как сочетание клавиш, где первый символ
говорит нам какую контрольную клавишу следует нажать первой, а второй символ
(после тире) - клавиша которую следует нажать после.  
Если же в треугольных скобках символы без `-`, значит это одна особая клавиша.

| Сочетание клавиш | Обозначение |
|-----------|------------|
| `<S-n>` | Shift + n |
| `<C-n>` | Ctrl + n |
| `<M-n>` | Alt + n |

| Особая клавиша | Название |
|-----------|------------|
| `<Esc>` | Escape |
| `<CR>` | Carriage return (Enter) |
| `<BS>` | Backspace |
| `<Del>` | Delete |
| ... | ... |

Итак, вернёмся к нашему, как мы уже узнали сочетанию клавиш `<C-v>`:

* `C` - обозначает контрольную клавишу `Ctrl`
* `v` - обозначает обычную клавишу `v`

Нажимаем `Ctrl + v` - поздравляю, мы в блочном режиме.

Что такого нам позволяет блочный режим, что нельзя делать в символьном или
строчном визуальных режимах? В основном это осуществление операций над концом и
началом строк неопределённый длины, допустим у вас есть 3 строки, на концах
которых вы бы хотели проставить `;`.
Сделать это можно нажав следующие клавиши `<C-v>jjj$A;<Esc>`

1. `<C-v>` - переходим в блочный визуальный режим;
1. `3j` выделяем 3 строки вниз;
1. `$` перемещаем блочное выделение в конец каждой строки;
1. `A` переходим в режим ввода используя `A`, чтобы курсор был именно в конце
   каждой строки;
1. `;` - в режиме ввода набираем символ точки с запятой;
1. `<Esc>` - выходим из режима ввода.

По аналогии, можно вставить любое количество символов в начало строки используя
`I` .

### Существительные (движения) и глаголы (действия)

Нет, у нас не начался урок русского языка. В Vim есть собственный *"язык"* - то
есть у каждой клавиши есть определённая семантика. Безусловно, использовать Vim
можно и не зная семантики клавиш, но тогда очень легко совершить ошибку,
которая стала результатом легендарного ответа на StackOverflow:  [Your problem
with Vim is that you don't grok vi](https://gist.github.com/nifl/1178878)
(прим. перевод - "Ваша проблема с Vim, заключается в том, что вы не понимаете
Vi").  Если быть кратким, то в ответе говорится что пользователь пытается
оперировать Vim, как если бы это был обычный текстовый редактор: запомнить пару
сочетаний клавиш и на этом всё.

Существительные это все те движения о которых мы говорили в Обычном режиме, а
глаголы это действия над текстом: удали, измени, переключи регистр,
увеличь число под курсором на 1, и т.д.

Как мы уже знаем, если мы хотим выполнить движение, мы набираем количества раз
которое мы хотим это движение повторить, и затем вводим символ самого движения.

С действиями процесс аналогичен, только в самом начале мы определяем само действие.  
`[действие][кол-во][движение]` или просто `[действие][движение]`.

Самые часто используемые действия это: `d` - удаление (delete) и `c` -
изменение (change). Если с удалением всё понятно, то изменение это удаление с
последующим переключением в режим ввода. Так `dw` - удалит символы от текущего
положения курсора, до следующего слова и оставит нас в обычном режиме, а `cw` -
удалит тот же отрезок текста что и `dw` , но в конце переключит нас в режим
ввода.

Кстати, для отмены любых изменений используйте клавишу `u` (от англ. undo - отменить)

Но что если наш курсор находится в середине слова над которым мы хотим
оперировать? Допустим у нас есть большое название метода которое мы хотим
изменить. Здесь нам на помощь приходят текстовые объекты - это определённые
отрезки текста которые Vim понимает.

Текстовые объекты можно использовать с действиями, вместо движения:  
`[действие][кол-во][движение|текстовый объект]` и `[действие][движение|текстовый объект]` и 

Итак, для примера о котором я говорил ранее, будем использовать текстовый объект `iw` -
inner word (от англ. внутреннее слово), целиком наша команда будет выглядеть так `ciw`.
Название метода исчезло как по волшебству, и курсор "приглашает" нас ввести новое название
для нашего метода.

Что именно делают текстовые объекты? Они позволяют нам оперировать над определёнными
отрезками текста, внутри которого на данный момент находится курсор.

| Текстовый  объект | Назначение |
|-----------|------------|
| `iw` | -- |
| `aw` | -- |
| `is` | -- |
| `as` | -- |
| `ip` | -- |
| `ap` | -- |
| `i(`, `i)` | -- |
| `a(`, `a)` | -- |
| `i"`, `i'` | -- |
| `a"`, `a'` | -- |
| ... | ... |

## Практика
