# Почему и как я использую Vim

## Вступление

Привет, меня зовут **BrotifyPacha**, Vim является моим текстовым редактором уже
почти год. Я использую его как **Php/Python** ide, и помимо чистого Vim,
использую эмулятор IdeaVim в **Android Studio**.

Да, скорее всего это зависимость, т.к. при использовании любого другого
текстового редактора более получаса у меня появляются следующие симптомы:

* Учащённое сердцебиение _(когда приходится перемещаться туда суда используя
  мышку)_
* Раздражительность _(если вдруг понадобилось сменить двойные кавычки на
  одинарные, или наоборот)_
* Дрож в руках (когда нужно найти другой файл)

Ладно, отбросив шутки в сторону, Vim не только мой редактор исходного кода,
я также использую его для просмотра лог файлов, json документов и
работы с .csv файлами, даже git я использую через Vim.

Сейчас сделаю для вас небольшой тест драйв:  
_Открываю учебный проектик прорабатываю создание фичи от получения задачи до коммита_

Я не буду вам рассказывать в каком году был создан Vim. Как называется
программа на которой он основан. Или как зовут его автора. Это всё вы, при
желании, можете узнать из википедии.  
Я расскажу вам про подход который используется в Vim для работы с текстом и **4
основных режима** работы и для чего каждый из них нужен.

## Подход к работе с текстом

За большинством архитектурных решениий Vim лежит один принцип - при
работе с текстовыми документами, чаще всего, пользователи не вводят новый текст,
а манипулируют уже существующим. Это правдиво не только для
программистов, но и для писателей.
Реализовано это тем, что Vim является режимным
текстовым редактором. Что это значит?
В без-режимном текстовом редакторе, (блокноте windows, notepad++, sublime)
каждая клавиша напрямую пишет символ в файл,
а в Vim, действие которое будет сделано по нажатию на клавишу, зависит
от того, в каком режиме находится пользователь.

Вот к примеру действие клавиши i в разных режимах

| Режим | Действие |
|-|-|
| Normal | Переход в режим ввода |
| Insert | Напечатать символ i |
| Command | Напечатать символ i в командную строку |
| Visual | Ничего |

## 4 основных режима

### Normal mode (Обычный режим)

Уже из названия можно понять что это режим в
котором мы должны проводить большую часть нашего времени.  В этом режиме мы
оказываемся сразу после запуска. А попасть в этот режим из другого режима мы
можем нажав клавишу `Esc` (от англ. escape - *"убежать"* из другого режима обратно в обычный).

Используется он, в основном, для перемещения по файлу и внесения правок в 
существующий текст. Осуществляется это посредством - **Действий** и **Движений**.

**Действия** это правки текста (удаление, изменение и т.д.), а **Движения** это
перемещение курсора. Также действия и движения можно комбинировать для того
чтобы осуществить **Действие** на протяжении всего текста которое будет покрыто
**Движением**

Сейчас, чтобы вас не переутомить, мы рассмотрим только **Движения**, а после
того как ознакомимся со всеми режимами приступим к разбору **Действий** и их
комбинации с **Движениями**.

Самыми простыми движениями являются `h` `j` `k` `l`,

* `h` - перемесить курсор на один символ влево
* `j` - на один символ вниз
* `k` - на один символ вверх
* `l` - на один символ вправо

Поначалу, это очень не удобно, и каждый раз возникает вопрос: почему именно они?
Ответ прост - эргономика. Эти клавиши лежат на так называемой *"Домашней строке"*
\- это строка клавиш, на которой пользователь должен держать пальцы для наибольшей
эффективности набора текста.

Если не считать эти 4 клавиши, то Vim имеет самые легко запоминающиеся сочетания
клавиш, по сравнению с любой программой которую я когда либо использовал.
К примеру:

Для перемещения в начало строки используется символ `0`. Мнемоника простая -
начало строки это нулевой символ.

Для перемещения в конец строки используется символ `$`. Знак доллара в
регулярных используется для обозначения конца строки.

Допустим у вас есть строка с отступами, и вам необходимо *"прыгнуть"* в
начало строки, `0` перенесёт вас на самый первый символ (пробел или таб),
но что если вам нужно попасть на первый "не пустой" символ строки?
Для этого используйте `^`.

Перемещаться внутри строки используя только `h` и `l` довольно медленно, попробуйте
`w` , `e` и `b` . Эти клавиши перемещают курсор по словам:

* следующее слово - `w` (от англ. word - слово)
* конец слова - `e` (от англ. end - конец)
* предыдущее слово - `b` (от англ. backwards - назад)

Эти же клавиши работают в верхнем регистре но немного иначе, если клавиши `w` ,
`e` , `b` перемещают нас по *"словам"* разделённым пробелами и символами
пунктуации, то их заглавные вариации `W` , `E` , `B` перемещают нас
исключительно по *"Словам"* разделённым пробелами.

Перед всеми клавишами перемещения можно добавить число, чтобы воспроизвести движение
множество раз:  
`4l` = `llll` , `3w` = `www` , `2w3e` = `wweee` , `100b` = `bbbbbb...bbbbbb` (100 раз).

Пока на этом остановимся, попрактикуйтесь в перемещении по строке и между строк.
К перемещению мы ещё вернёмся но чуть позже.

Если вам прямо не терпится, то вот ещё клавиши используя которые можно *"побегать"*
по файлу:  
`{` , `}` , `f` , `F` , `t` , `T` .

Попробуйте понять куда вас перемещают клавиши `f` и `t`, и чем отличаются их
заглавные варианты. Если случайно нажмёте куда то не туда - не волнуйтесь.
Нажмите несколько раз `Esc`, и вы вернётесь домой - в Normal mode.

### Insert mode (Режим ввода)

Режим в который мы "входим" когда нам нужно что то написать, переписать или
дописать.  Для переключения в этот режим используется клавиша `i` (i от
англ. insert - ввод). Заметьте, именно в нижнем регистре, потому что
`I` не просто переключает нас в режим ввода, но и ставит курсор в начало
строки.

Клавиши `i` и `I` не являются единственными клавишами которые
переключают нас в режим ввода, чтобы попасть в режим ввода также можно
использовать клавиши `a` , `A` , `c` , `C` , `s` , `S`.
На первый взгляд выглядит нелепо: столько клавиш потрачено в пустую, лишь для
того, чтобы переключать нас в режим ввода, но это не совсем так. Да, после нажатия
этих клавиш мы окажемся в режиме ввода, но каждая из них доставит нас туда слегка
иным путём:

* Клавиша `a`, в отличии от `i` поставит курсор, после символа, на котором
он находился в обычном режиме (от англ. after - после).
* Клавиша `A`, по аналогии с `I` поставит курсор, в конце строки.
* Клавиша `s`, перед переносом нас в режим ввода, удалит символ под курсором.
* Клавиша `S`, перед переносом нас в режим ввода, удалит весь текст на текущей строке.

Хочу обратить ваше внимание на семантическую однородность в Vim:  
Хочешь выполнить действие?  
\- Нажми клавишу `n`  
Хочешь выполнить это действие но на большем масштабе?  
\- Нажми клавишу `N` (та же клавиша но в верхнем регистре)

**Важный ньюанс:** будучи в режиме ввода мы можем удалять любой текст, но для
этой цели следует использовать
обычный режим (Normal), т.к. в нём мы можем делать это гораздо эргономичнее -
используя действия в комбинации с движениями.

### Command mode (Командный режим / Режим инструкций)

Попадаем мы в этот режим нажав в обычном режиме клавишу `:`. По нажатию на неё
наш курсор прыгает вниз - в командную строку, здесь мы вводим наши команды.

Эта командная строка, по своей сути, является интерпритатором языка скриптов
VimScript (локальный для Vim язык), поэтому все команды которые она принимает
являются выражениями этого языка.

Мы не будем с вами рассматривать управляющие конструкции и циклы, мы рассмотрим
лишь команды которые необходимы именно при редакторовании файлов и установки
каких либо настроек Vim.

#### :write - сохранение

Эта команда используется для сохранения файла - записи данных в файл
(от англ. write - запись)

Синтаксис - `:w[rite][!][ название файла]`

Части `rite`, `!` и `название файла` - опциональные, поэтому написаны в
квадратных скобках.

Давайте разберём что они из себя представляют:

`rite` - это опциональная часть показывающая *полную* версию команды.
Такая опциональная часть есть у подавляющего большинства команд, *полная*
версия команд чаше всего используется в скриптах Vim для улучшения читаемости.
Команда без этой опциональной части называется *короткой* версией. То есть
`:w` - это *короткая* версия команды `:write`.

`!` (восклицательный знак) - опциональный параметр, использующийся в случае,
когда требуется перезаписать файл.

` название файла` - опциональный параметр, использующийся в случае, когда мы
хотим сохранить новый файл (у которого до этого не было имени) или уже
следующий но под другим именем.

#### :quit - выход

Эта команда используется для выхода из Vim.

Синтаксис - `:q[uit][!]`

Эта команда имеет лишь две опциональные части `uit` и `!`:

`uit` - здесь также для обозначения *полной* версии команды.

`!` - используется для принудительного выхода в случае когда есть несохранённые
изменения в файле. Без него Vim не позволит нам выйти.

#### :set - установка настроек

Эта команда позволяет задать какую либо настройку Vim.

Синтаксис - `:set [настройка]`

Как можно заметить из синтаксиса, у этой команды нет *короткой* версии.
Единственный опциональный параметр здесь это настройка которую мы хотим
активировать.

Вот несколько настроек которые вам скорее всего будут полезны

* `:set number` или `:set nu` - отображать номера строк;
* `:set nonumber` или `:set nonu` - не отображать номера строк;
* `:set relativanumber` или `:set rnu` - как и `number` только номера строк
  будут относительно текущей строки. Это очень удобно если вы для перемещения
  файлу используете клавиши `j` и `k`;
* `:set norelativanumber` или `:set nornu` - выключает `rnu`;
* `:set wrap` - переносить текст на новую строку
* `:set nowrap` - не переносить текст на новую строку
* `:set autoindent` - ai Сохранять отступ при создании новой строки
* `:set noautoindent` noai Не сохранять отступ при создании новой строки

### Visual mode (Визуальный режим)

Режим в котором мы визуально выделяем текст для последующей манипуляции. Для
того чтобы в него попасть используются клавиши `v` , `V` , `<C-v>` .
Три разных клавиши для трёх разных типов визуального режима:

* Используюя клавишу `v` мы попадаем в символьный визуальный режим
* Используюя клавишу `V` мы попадаем в строчный визуальный режим
* А используюя `<C-v>` мы попадаем в блочный визуальный режим

Названия говорят за себя: в символьном выбор осуществляется по символам,
в строчном - по строкам, в блочном - блоком.

#### Синтаксис обозначения сочетаний клавиш Vim

Вы сейчас скорее всего задаётесь вопросом, что за `<C-v>`? Как это набрать?
Это уже упомянутая мной клавишная нотация Vim. Читается она следующим образом,
если внутри треугольных скобок символы разделены знаком `-` (как в нашем
случае), то мы должны воспринимать это как сочетание клавиш, где первый символ
говорит нам какую контрольную клавишу следует нажать первой, а второй символ
(после тире) - клавиша которую следует нажать после.  
Если же в треугольных скобках символы без `-`, значит это одна особая клавиша.

| Сочетание клавиш | Обозначение |
|-----------|------------|
| `<S-n>` | Shift + n |
| `<C-n>` | Ctrl + n |
| `<M-n>` | Alt + n |

| Особая клавиша | Название |
|-----------|------------|
| `<Esc>` | Escape |
| `<CR>` | Carriage return (Enter) |
| `<BS>` | Backspace |
| `<Del>` | Delete |
| ... | ... |

Итак, вернёмся к нашему, как мы уже узнали сочетанию клавиш `<C-v>`:

* `C` - обозначает контрольную клавишу `Ctrl`
* `v` - обозначает обычную клавишу `v`

Нажимаем `Ctrl + v` - поздравляю, мы в блочном режиме.

Что такого нам позволяет блочный режим, что нельзя делать в символьном или
строчном визуальных режимах? В основном это осуществление операций над концом и
началом строк неопределённый длины, допустим у вас есть 3 строки, на концах
которых вы бы хотели проставить `;`.
Сделать это можно нажав следующие клавиши `<C-v>jjj$A;<Esc>`

1. `<C-v>` - переходим в блочный визуальный режим;
1. `3j` выделяем 3 строки вниз;
1. `$` перемещаем блочное выделение в конец каждой строки;
1. `A` переходим в режим ввода используя `A`, чтобы курсор был именно в конце
   каждой строки;
1. `;` - в режиме ввода набираем символ точки с запятой;
1. `<Esc>` - выходим из режима ввода.

По аналогии, можно вставить любое количество символов в начало строки используя
`I` .

## Действия и комбинирование их с Движениями

Есть два вида **действий** - те что манипулируют над символом под корсором и те
что для работы требуют **движение**.

Рассмотрим сначала первые:

* `r` - (от англ. replace - замена) заменить символ под курсором на тот, что мы
  введём сладующим;
* `x` - удалить символ под курсором;
* `~` - изменить регистр символа под курсором (сделать из заглавной буквы строчную
  и наоборот);
* `u` - отменить последнее действие;
* `<C-a>` - увеличить число под курсором на 1;
* `<C-x>` - уменьшить число под курсором на 1;

Перед всеми этими **действиями**, как и перед **движениями** можно добавить число,
но использоваться это число будет для каждого из них немного иначе.

`r`, `x` и `~` без числа манипулируют только над одним символом - символом
под курсором. Добавляя число мы увеличиваем их область действия: `3rA` - заменит
3 символа, включая символ под курсором на символ A, `3x` - удалит три смвола, а
`3~` - инвертирует регистр трёх символов, включая символ под курсором.

`u` без числа отменяет последнее действие, добавив число N, можно отменить N
действий.

`<C-a>` и `<C-x>` прибавляет и убавляет 1, добавив перед ними число N, они будут 
добавлять и убавлять число N к числу под курсором: имея под курсором число 13,
`<C-a>` прибавит 1, получится 14, а `4<C-x>` убавит 4, получится 10.

Теперь рассмотрим второй вид действий - те что требуют движения.

Сначала мы нажимаем клавишу действия, затем определяем движение (определять движение
можно с числом):  
`[действие][число][движение]` или просто `[действие][движение]`.

Список действий

* `d` - (от англ. delete - удалить) удаление символов покрытых движением;
* `с` - (от англ. change - изменить) изменение символов;
* `>` - увеличить уровень отступа;
* `<` - уменьшить уровень отступа;
* `=` - выровнять согласно синтаксису;
* `gu` - поменять регистр на нижний;
* `gU` - поменять регистр на верхний;
* `g~` - инвертировать регистр.

Самые часто используемые действия это: `d` и `c`. Если с удалением всё понятно,
то изменение это удаление с последующим переключением в режим ввода.

Так `dw` - удалит символы от текущего положения курсора, до следующего слова и
оставит нас в обычном режиме, а `cw` - удалит тот же отрезок текста что и `dw`,
но в конце переключит нас в режим ввода.

### Текстовые объекты

Но что если наш курсор находится в середине слова над которым мы хотим
оперировать? Допустим у нас есть большое название метода которое мы хотим
изменить. Здесь нам на помощь приходят текстовые объекты - это определённые
отрезки текста которые Vim понимает.

Используются они как движения, то есть, условный синтаксис любой операции в Vim
выглядит так:  
`[действие][кол-во][движение|текстовый объект]` или
`[действие][движение|текстовый объект]`

Итак, для примера о котором я говорил ранее, будем использовать текстовый объект `iw` -
inner word (от англ. внутреннее слово), целиком наша команда будет выглядеть так `ciw`.
Название метода исчезло как по волшебству, и курсор "приглашает" нас ввести новое название
для нашего метода.

Что именно делают текстовые объекты? Они позволяют нам оперировать над определёнными
отрезками текста, внутри которого на данный момент находится курсор.

* `iw` - текущее слово (проще всего мне запомнилось как **I**n **W**ord, внутри
  слова);
* `aw` - как `iw`, но также охватывает пробел, находящийся перед этим
  словом (**A**round **W**ord, вокруг слова);
* `is` - текущее предложение (**I**n **S**entance, внутри предложения);
* `as` - аналогично `iw`/`aw`, охватывает текущее предложение и символ
  пробела перед ним (**A**round **S**entance, вокруг предложение);
* `ip` - текущий параграф (**I**n **P**aragraph, внутри параграфа);
* `ap` - текущий параграф, и пустая строка перед ним (**A**round **P**aragraph,
  вокруг параграфа);
* `it` - текст вунтри текущего HTML тега;
* `at` - текст вунтри текущего HTML тега, а также сам тег;
* `i(`, `i[`, `i{`, `i<`, `` i` ``, `i'`, `i"` - весь
текст в внутри скобок/кавычек;
* `a(`, `a[`, `a{`, `a<`, `` a` ``, `a'`, `a"` - как и
`i`, но также охватывает сами скобки/кавычки.

Для `iw` и `aw`, также есть `iW` и `aW`, которые работают точно также как и движения
`W`.
И для текстовых объектов внутри/вокруг скобок, также можно использовать закрывающие
скобки, то есть `i{` = `i}`, `a[` = `a]` и т.д.

Когда я только начинал познавать Vim, именно открытие текстовых объектов стало
для меня точкой невозврата к обычным текстовым редакторам: нужно поменять
аргументы метода - `ci(`, название метода - `ciw`, значение в кавычках - `ci"`, и
не нужно для этого использовать мышку.

### Оперирование над строками

При работе с кодом часто необходимо оперировать над целыми строками. Для того 
чтобы осуществить действие на всю строку, клавишу этого действия нужно нажать 
дважды.

* `dd` - удалить всю строку на которой находится курсор;
* `cc` - изменить строку (при этом сохраниться текущий отступ);
* `>>` - увеличить уровень отступа всей строки на 1;
* `<<` - уменьшить уровень отступа всей строки на 1;
* `==` - выровнять строку согласно синтаксису.

Эти действия также могут использоваться с числами перед ними: 

* `3dd` - удалит 3 строки;
* `3cc` - удалит 3 строки и оставит нас в режиме ввода;
* `2>>` - увеличит уровень отступа всей строки на 2;
* `5==` - выровняет согласно синтаксису 5 строк включая текущую.

## Прокрутка экрана

## Копировать / вставить

### Копирование - Yank

Для осуществление копирования используется действие `y`, принимающее движение.
Почему не `c`? `c` (от англ. change - изменить) уже занята. Так что выбрана `y`
(от англ. yank - хватать), представьте просто что при копировании вы *хватаете*
определённый кусок текста и кладете его себе в карман - сразу запоминается.

Примеры использвания `y`:

* `yiW` или `yiw` - скопировать текущее *слово*;
* `yi{` или `yi}` - скопировать тело метода Си-подобного языка;
* `yi"` или `yi'` - скопировать содержимое кавычек;
* `yy` - скопировать текущую строку;
* `2yy` - скопировать текущую и следующую строки;

Обратите внимание что правило дублирования действия (`yy`) для осуществление его
на всю строку также работает.

### Вставка - Paste

## Регистры

